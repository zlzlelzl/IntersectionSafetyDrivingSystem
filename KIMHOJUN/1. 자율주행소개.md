# 자율주행이란?
### 자율주행 자동차의 필요성
- 전 세계적으로 자율주행은 큰 이슈가 되고 있고, 빠르게 발전하고 있음
- 미 도로교통국, "따르면 운전자의 실수가 차량 사고의 원인중 90% 이상을 차지"
- 운전자가 운전에 개입하지 않을 경우 사고는 줄어들 것이라는 기대
    - 2020년 4분기 기준 테슬라 ADAS는 1억 6000만km 당 46.8건의 교통사고 발생
    - 사람이 운전할 경우 49.5건의 교통하고 발생으로 조사됨
- 큰 차이는 아니나 악천후에 돌발상황에 대한 대응이 부족한 상황
- 자율주행 자동차는 사고 시 치명상 확률이 더 높음

## 자율주행 자동화의 단계적 구분
## SAE(Society of Automotive Engineers)에서 정의
- 레벨0 : 운전자가 모든 차량을 제어
- 레벨1 : 자율주행 시스템은 운전자를 보조, 시스템이 제한된 상황에서 속도나 조항을 하는 단계
- 레벨2 : 시스템이 조항과 속도를 제어
- 레벨3 : 비상시에만 운전자가 개입하고, 제한된 조건에서 차량이 자율적으로 주행
- 레벨4 : 운전석이 필요없으며, 시스템이 특정지역에서 자율적으로 운행
- 레벨5 : 레벨4와 같지만 전지역에 해당

**현재 자율주행 단계는 2~3단계 수준에 머물러 있음**

## 자율주행 자동차에서 핵심기술이자 프로세스의 3단계

![88](https://user-images.githubusercontent.com/104968672/220841511-8f93a01d-f237-40fa-a335-f2f9d9dd0dba.PNG)

- 인지 : 주변 상황에 대한 정확한 인식
- 판단 : 인식에 기반한 정확한 판단
- 제어 : 판단에 기반한 올바른 제어

# 인지
## Object Detection
    - 어떤 이미지가 입력으로 주어졌을 때, 해당 객체들을 인식하고 객체가 무엇인지 분류해주는 기술
    - Classification : 이미지에 따라서 labeling을 해주는 것
    - Localization : 이미지에 객체가 어디에 있는지 bounding box를 만들어주는 것, Classification과 Localization이 결합이 되면 아래 자료와 같이 bounding box와 labeling을 동시에 표시
    - Detection : 이미지 내의 여러 이미지들을 찾아내는 것

## Deep learning object detection
    - 자율주행에서 빠질 수 없는 요소로 딥러닝이 있음
        - Single short detection, YOLO, Faster R-CNN 등
        - 인간이 경험을 거치며 스스로 학습하는 과정을 모방, 인공지능을 만들어내는 기술
        - 지금까지 연구된 여러 머신러닝 기술 중 가장 주목 받는 건 인간 뇌를 형성하는 신경망을 모방해 학습하는 딥러닝임
        - 자율주행 자동차가 스스로 주행하려면 주변환경 인지, 주행 도로 판단과 선정, 안전한 기능 제어 등 3가지 기능이 반드시 수반되어야 함
            - 딥러닝 기술은 이 기능 모두에 활용될 수 있음
            - 실제로 여러 곳에서 자율주행 자동차의 인지/판단/제어 기능 향상에 딥러닝을 적용하는 연구가 활발하게 진행되고 있음

## 정밀도로 지도
    - 자율주행 등에 필요한 정보를 3차원으로 제작한 전자 지도
        - 차선 (규제선, 도로경계선, 정지선, 차로 중심선)
        - 도로시설 (중앙분리대, 터널, 교량, 지하차도)
        - 표지시설 (교통안전표지, 노면표시, 신호기)
    - 해상도 0.25급
    - 국토지리정보원에서 제작하고 배포

## 정밀도로 지도의 종류
- PointCloud Map
    - PointCloud의 사전적 의미는 3차원 좌표를 가지고 있는 점들로 불규칙하게 구성된 데이터를 말함, 점구름 또는 점군데이터로 불림
    - 자율주행에서 포인트클라우드는 라이다(LiDAR) 센서나 RGB-D 센서등으로 부터 수집된 데이터를 말함
    - 센서들을 물체에 빛/신호를 보내서 돌아오는 시간을 기록하여 각 빛/신호 당 거리 정보 등을 계산하여 하나의 포인트 생성
    - 이러한 포인트들이 3차원 공간상에 퍼져있는 집합
- HD Map (Vector Map)
    - 도로 위에 있는 신호등, 교차로 등을 벡터 데이터로 표현하여 지도로 만들어 놓은 것
    - 포인트 클라우드는 형상만이 남아있고, 차선 등의 정보는 없지만 이 HD Map은 주행에 필요한 의미있는 정보를 표현
    - HD Map의 차선 등의 정보가 자율주행 차량의 성능에 큰 영향을 미침
- Grid Map
    - 격자 지도로 자료가 격자의 형태로 전달되어지는 지도
    - 경로 계획, 경로 생성 등에 많이 사용
    - 포인트 클라우드 맵보다 상대적으로 용량이 작기 때문에 공간을 표현하는 정밀도가 조금 떨어짐

## 인지에 사용되는 센서들
- 카메라(Camera)
    - 다양한 정보를 얻을 수 있지만, 객체를 인식하기 위해선 여러 연산이 필요
    - 밤, 악천후에는 정보의 품질이 떨어지기 쉬움
- 라이다(LiDAR)
    - 레이저(빛)를 매개체로 사물간 거리 및 형태를 파악
    - 정밀하지만, 가격이 비싸고 외부 환경에 영향을 많이 받음
    - 큰 외향과 에너지 소비율 때문에 자율주행 차량들에 많이 채택되지 않았었지만, 최근 라이다 센서의 발전으로 많이 사용되고 있음
- 레이더 (Radar)
    - 전파를 매개체로 사물간 거리 및 형태를 파악
    - 라이다 센서보다 정밀도는 떨어지지만 소형화가 가능하고 보다 저렴하며 악천후에 강함
    - 사이즈가 곧 성능

# 판단/제어
## 경로계획
- 차량이 장애물을 회피하면서 목표지점까자지 최적의 경로로 도달하게 하는 기술

- 전역 경로 계획
    - 지도에 기반하여 경로를 자율적으로 생성

- 지역 경로 계획
    - 지도 정보로부터 나와 있지 않은 예기치 못한 장애물이나 움직이는 장애물에 대해 여러 가지 센서를 이용하여 장애물을 피해가며 경로를 재생성

## 전역 경로 계획
- 주행 기록을 이용한 전역 경로 생성
    - 전역 경로 계획 방법의 가장 직관적인 방법은, 만들고 싶은 경로를 차량으로 직접 주행하여 나온 차량의 위치 좌표를 기록하는 방법
    - 기록된 차량의 위치정보 하나하나가 웨이포인트가 됨
    - 데이터 가공

## 경로 계획
- 경로 생성 - 궤적
    - 차선변경이나 경로를 변경하기 위한 궤적이 필요
    - 궤적을 만들 때 가장 쉬운 방법으로는 시작점과 끝점을 잇는 방법
    - 표면적으로는 매우 깨끗한 차선변경이 이루어 질 것 처럼 보임
    - 차선 변경이 시작하는 순간과 차선 변경이 완료되는 시점에 큰 각도의 변화량이 필요함
    - 높은 각속도를 피하기 위해서 시작점과 끝점을 잇는 3차 곡선을 만들어 궤적을 생성
    - 3차 곡선의 경우 매 순간 각도의 변화량이 존재하여 차선변경 시작점과 끝점에서 큰 각도 변화를 피할 수 있음

- 경로 추종
    - 경로를 추종하는 방법은 여러가지가 있으며, 대표적으로 Pure pursuit guidance가 있음
        - 경로 위의 한 점을 원 호를 그리며 경로를 추종하는 알고리즘
        - 자동차의 기구학과 전방주시거리 (Look-Ahead-Distance)라는 하나의 파라미터를 가지고 조향각을 간단하게 계산
        - Pure pursuit에서는 실제 자동차 모델 (Ackerman geometry)을 단순화 한 Bicycle 모델 사용

## 속도 제어
- 제어 인식 및 판단 결과에 따른 자율주행 시스템의 작동
    - 인식 및 판단 결과에 따른 자율주행 시스템의 작동
    - 실제 차를 어떻게 움직일지 구동계와 조향계에 명령

- 전방차량 추종 (Adaptive Cruise Control)을 위한 거리 및 속도 제어

- 긴급제동 (Autonomous Emergency Braking)
- PID 제어기를 활용한 거리 및 속도 유지 제어기 설계

- 제어 인식 및 판단 결과에 따른 자율주행 시스템의 작동
    - 인식 및 판단 결과에 따른 자율주행 시스템의 작동
    - 실제 차를 어떻게 움직일지 구동계와 조향계에 명령

- PID 제어
- 비례-적분-미분 (Proportional-Integral-Differential controller)

![77](https://user-images.githubusercontent.com/104968672/220841325-acb14569-4e08-40ad-a035-76150717ec6e.PNG)

- 내 차량의 상태와 목표 차량의 상태와의 오차 값을 이용해 제어값 계산
    - 비례항 : 현재 상태에서의 오차 값을 이용해 제어값 계산
    - 적분항 : 정상 상태에서의 오차를 없애는 작용
    - 미분항 : 출력값의 급격한 변화에 제동을 걸어 오버슛을 줄이고 안정성을 향상

